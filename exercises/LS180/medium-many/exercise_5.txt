// LS180 - SQL Fundamentals, Medium: Many to Many, Services for each Customer

SELECT customers.name, 
string_agg(services.description, ', ') AS services
FROM customers
LEFT OUTER JOIN customers_services ON customers.id = customers_services.customer_id
LEFT OUTER JOIN services ON customers_services.service_id = services.id
GROUP BY customers.name;


// FURTHER EXPLORATION

SELECT CASE
WHEN (lag(customers.name) OVER (ORDER BY customers.name)) = customers.name
THEN ''
ELSE customers.name
END,
services.description
FROM customers
LEFT OUTER JOIN customers_services ON customers.id = customers_services.customer_id
LEFT OUTER JOIN services ON customers_services.service_id = services.id;